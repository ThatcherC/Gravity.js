function init(){var t=document.getElementById("canvas"),e=document.getElementById("controlbox");t.width=window.innerWidth-30,t.height=window.innerHeight-20,width=t.width,height=t.height,context=t.getContext("2d"),window.addEventListener("mousedown",mouseDownListener,!1),e.onmouseover=function(){onControlBox=!0},e.onmouseout=function(){onControlBox=!1}}function main(){starttime=Date.now(),integrate(),draw(),frametime=Date.now()-starttime}function mouseDownListener(t){onControlBox||(console.log("down"),startCoords[0]=t.clientX,startCoords[1]=t.clientY,endCoords[0]=t.clientX,endCoords[1]=t.clientY,window.addEventListener("mousemove",mouseMoveListener,!1),window.addEventListener("mouseup",mouseUpListener,!1))}function mouseMoveListener(t){endCoords[0]=t.clientX,endCoords[1]=t.clientY}function mouseUpListener(){console.log("up"),window.removeEventListener("mousemove",mouseMoveListener),window.removeEventListener("mouseup",mouseUpListener);var t=new Particle(newMass,startCoords[0],startCoords[1],endCoords[0]-startCoords[0],endCoords[1]-startCoords[1]);particleList.push(t),startCoords=[-1,-1],endCoords=[-1,-1]}function setNewMass(t){console.log(t),newMass=t}function integrate(){for(var t=new Array,e=0;e<particleList.length;e++){for(var o=particleList[e],i=0,r=0,s=0;s<particleList.length;s++)if(otherParticle=particleList[s],o!=otherParticle&&!o.collided&&!otherParticle.collided){var a=otherParticle.x-o.x,n=otherParticle.y-o.y,l=Math.sqrt(a*a+n*n);if(l<o.radius/1.5+otherParticle.radius/1.5){o.collided=!0,otherParticle.collided=!0;var c=o.mass+otherParticle.mass,d=new Particle(c,(o.x*o.mass+otherParticle.x*otherParticle.mass)/c,(o.y*o.mass+otherParticle.y*otherParticle.mass)/c,(o.vx*o.mass+otherParticle.vx*otherParticle.mass)/c,(o.vy*o.mass+otherParticle.vy*otherParticle.mass)/c);t.push(d)}var u=otherParticle.mass/(l*l);i+=u*a/l,r+=u*n/l}o.ax=i,o.ay=r}for(var m=0;m<particleList.length;m++)particleList[m].vx+=particleList[m].ax*h,particleList[m].vy+=particleList[m].ay*h,particleList[m].x+=particleList[m].vx*h,particleList[m].y+=particleList[m].vy*h,(particleList[m].collided||particleList[m].x<-50||particleList[m].y<-50||particleList[m].x>width+50||particleList[m].y>height+50)&&(particleList.splice(m,1),m--);Array.prototype.push.apply(particleList,t)}function draw(){context.clearRect(0,0,width,height),context.beginPath(),context.moveTo(startCoords[0],startCoords[1]),context.lineTo(endCoords[0],endCoords[1]),context.strokeStyle="blue",context.strokeWidth=2,context.stroke();for(var t=0;t<particleList.length;t++){var e=particleList[t];if(context.beginPath(),context.arc(e.x,e.y,e.radius,0,2*Math.PI),context.closePath(),e.radius<3)context.fillStyle="#"+Math.round(e.color).toString(16);else{var o=context.createRadialGradient(e.x,e.y,.75*e.radius,e.x,e.y,e.radius);o.addColorStop(0,"#"+Math.round(e.color).toString(16)),o.addColorStop(1,"black"),context.fillStyle=o}context.fill()}}function Particle(t,e,o,i,r){this.mass=t,this.x=e,this.y=o,this.px=e,this.py=o,this.vx=i,this.vy=r,this.ax=0,this.ay=0,this.collided=!1,this.color=16711680,this.color+=255/(1+Math.pow(t/1e5,1))<<8,this.color+=255/(1+Math.pow(t/1e4,1)),this.radius=Math.log(Math.E+t/1e3)}var h=.005,context,particleList=new Array,context,frametime,starttime,width,height,startCoords=[-1,-1],endCoords=[-1,-1],newMass=1e3,onControlBox=!1;